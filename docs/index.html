<!DOCTYPE html>
<html>
<head>
    <title>Driving Test Times NSW</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3757244523108835"
     crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Available Driving Test Times NSW</h1>
        <span id="lastUpdate">Last updated: Loading...</span>
        
        <!-- Side banners -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3757244523108835"
             data-ad-slot="2520879259"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

        <div id="debugData"></div> <!-- Add this for debugging -->
        <div class="locations-grid" id="locationsGrid">
            <!-- Locations will be dynamically loaded here -->
        </div>
    </div>

    <script>
        // Function to fetch and display the data
        async function loadTestTimes() {
            try {
                // Log the full URL we're fetching from
                console.log('Fetching from:', window.location.href + 'data.json');
                
                const response = await fetch('data.json');
                const data = await response.json();
                
                // Debug: Display raw data
                document.getElementById('debugData').textContent = 
                    'Raw data: ' + JSON.stringify(data, null, 2);
                console.log('Fetched data:', data);

                // Update last updated time
                const now = new Date();
                document.getElementById('lastUpdate').textContent = 
                    `Last updated: ${now.toLocaleString()}`;

                // Get the container for locations
                const locationsGrid = document.getElementById('locationsGrid');
                locationsGrid.innerHTML = ''; // Clear existing content

                // Create a card for each location
                for (const [location, dates] of Object.entries(data)) {
                    console.log('Processing location:', location, 'with dates:', dates);
                    
                    const card = document.createElement('div');
                    card.className = 'location-card';
                    card.onclick = function() { toggleTiming(this); };

                    // Create card content
                    let cardContent = `
                        <h2>${location}</h2>
                        <div class="timing-content">
                    `;

                    // Add each day's times
                    for (const [date, times] of Object.entries(dates)) {
                        console.log('Processing date:', date, 'with times:', times);
                        cardContent += `
                            <div class="day-section">
                                <h3>${date}</h3>
                                <p>${Array.isArray(times) ? times.join(', ') : times}</p>
                            </div>
                        `;
                    }

                    cardContent += '</div>';
                    card.innerHTML = cardContent;
                    locationsGrid.appendChild(card);
                }
            } catch (error) {
                console.error('Error loading test times:', error);
                document.getElementById('debugData').textContent = 
                    'Error: ' + error.message;
                document.getElementById('lastUpdate').textContent = 
                    'Error loading data. Please try again later.';
            }
        }

        function toggleTiming(card) {
            const timingContent = card.querySelector('.timing-content');
            timingContent.classList.toggle('active');
            document.querySelectorAll('.timing-content.active').forEach(content => {
                if (content !== timingContent) {
                    content.classList.remove('active');
                }
            });
        }

        // Load the data when the page loads
        document.addEventListener('DOMContentLoaded', loadTestTimes);

        // Refresh the data every 5 minutes
        setInterval(loadTestTimes, 300000);
    </script>
</body>
</html>
