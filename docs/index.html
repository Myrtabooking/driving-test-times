<!DOCTYPE html>
<html>
<head>
    <title>Driving Test Times NSW</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3757244523108835"
     crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Available Driving Test Times NSW</h1>
        <span id="lastUpdate">Last updated: Loading...</span>
        
        <!-- Side banners -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3757244523108835"
             data-ad-slot="2520879259"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

        <div class="locations-grid" id="locationsGrid">
            <!-- Locations will be dynamically loaded here -->
        </div>
    </div>

    <script>
        async function loadTestTimes() {
            try {
                const response = await fetch('data.json');
                const data = await response.json();
                
                // Update last updated time
                const now = new Date();
                document.getElementById('lastUpdate').textContent = 
                    `Last updated: ${now.toLocaleString()}`;

                // Get the container for locations
                const locationsGrid = document.getElementById('locationsGrid');
                locationsGrid.innerHTML = ''; // Clear existing content

                // Sort locations alphabetically
                const sortedLocations = Object.keys(data).sort();

                // Create a card for each location
                for (const location of sortedLocations) {
                    const dates = data[location];
                    
                    // Skip if no dates available
                    if (Object.keys(dates).length === 0) continue;

                    const card = document.createElement('div');
                    card.className = 'location-card';
                    card.onclick = function() { toggleTiming(this); };

                    // Create card content
                    let cardContent = `
                        <h2>${location}</h2>
                        <div class="timing-content">
                    `;

                    // Sort dates
                    const sortedDates = Object.keys(dates).sort((a, b) => {
                        const dateA = parseDate(a);
                        const dateB = parseDate(b);
                        return dateA - dateB;
                    });

                    // Add each day's times
                    for (const date of sortedDates) {
                        const times = dates[date];
                        if (times && times.length > 0) {
                            cardContent += `
                                <div class="day-section">
                                    <h3>${date}</h3>
                                    <p>${times.join(', ')}</p>
                                </div>
                            `;
                        }
                    }

                    cardContent += '</div>';
                    card.innerHTML = cardContent;
                    locationsGrid.appendChild(card);
                }
            } catch (error) {
                console.error('Error loading test times:', error);
                document.getElementById('lastUpdate').textContent = 
                    'Error loading data. Please try again later.';
            }
        }

        // Helper function to parse dates like "Fri 31/01"
        function parseDate(dateStr) {
            const [day, date] = dateStr.split(' ');
            const [dd, mm] = date.split('/');
            // Assuming all dates are in 2024
            return new Date(2024, parseInt(mm) - 1, parseInt(dd));
        }

        function toggleTiming(card) {
            const timingContent = card.querySelector('.timing-content');
            timingContent.classList.toggle('active');
            document.querySelectorAll('.timing-content.active').forEach(content => {
                if (content !== timingContent) {
                    content.classList.remove('active');
                }
            });
        }

        // Load the data when the page loads
        document.addEventListener('DOMContentLoaded', loadTestTimes);

        // Refresh the data every 5 minutes
        setInterval(loadTestTimes, 300000);
    </script>
</body>
</html>
